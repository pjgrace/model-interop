<?xml version="1.0"?>
<pattern  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

    <patterndata>
        <data>
            <name>apikey</name>
            <value>59bc2c19e39c0e9734ba225b9d78c6e6</value>
        </data>
        <data>
            <name>secret</name>
            <value>4eb65f311e7fd401</value>
        </data>
    </patterndata>
    
    <architecture>
        <component>
            <id>f_rest_comp</id>
            <address>api.flickr.com</address>
            <interface>
                <id>rest1</id>
                <url>https://api.flickr.com:443/services/rest/</url>
            </interface>
        </component>
    </architecture>
    
     <behaviour>
        <state>
          <label>A1</label>
          <type>triggerstart</type>
          <transition>    
                <to>A7</to>
                <message>
                    <url>component.f_rest_comp.rest1</url>
                    <path>?method=flickr.panda.getList&amp;api_key=$$patterndata.apikey$$</path>
                    <method>get</method>
                    <type>xml</type>
                </message>
           </transition>
        </state>
        <state>
          <label>A7</label>
          <type>normal</type>
          <transition>    
                <to>A2</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.f_rest_comp.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>200</value>
                    </equal>
                </guards>
           </transition>
        </state>

        <state>
          <label>A2</label>
          <type>loop</type>
          <transition>    
                <to>A3</to>
                <message>
                    <url>component.f_rest_comp.rest1</url>
                    <path>?method=flickr.panda.getPhotos&amp;api_key=$$patterndata.apikey$$&amp;panda_name=$$A7|content|//pandas/panda[%%counter%%]$$</path>
                    <method>get</method>
                    <type>xml</type>
                </message>
           </transition>
           <transition>    
                <to>A4</to>
                <guards>
                    <counter>
                        <param>$$A7|content|count(//pandas/*)$$</param>
                        <value>4</value>
                    </counter>
                </guards>
              </transition>
        </state>
        <state>
          <label>A3</label>
          <type>normal</type>
          <transition>    
                <to>A2</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.f_rest_comp.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>200</value>
                    </equal>
                </guards>
              </transition>
              
        </state>
        <state>
            <label>A4</label>
            <type>end</type>
        </state>
    </behaviour>

</pattern>
